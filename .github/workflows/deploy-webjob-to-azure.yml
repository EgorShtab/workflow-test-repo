name: Deploy Console To Test

on:
  workflow_dispatch:
    inputs:
      url:
        description: 'Url of data mover artifact'
        required: true
      webjob-cron:
        description: 'Webjob run time in CRON format'
        required: true
      output-path:
        description: 'Extracted zip path'
        required: true

jobs:
  download_artifacts:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Azure CLI
        uses: azure/login@v1
        with:
            creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Deploy WebJob
        run: |
            az webapp deployment source config \
                --resource-group gr-eshtab-dev \
                --name app-dataverse-to-sql-webjobs-test \
                --repo-url ${{ github.event.inputs.url }}
                --type zip \

      - name: Update WebJob Schedule
        run: |
            az webapp webjob continuous update \
                --resource-group gr-eshtab-dev \
                --name app-dataverse-to-sql-webjobs-test \
                --job-name test \
                --cron ${{ github.event.inputs.webjob-cron }}